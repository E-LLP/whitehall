<% page_title "Tag #{@edition.title}"  %>

<div class="row">
  <div class="col-md-8">
    <section>
      <h1><%= edition_tagging_headline(@edition) %></h1>

      <%= render 'similar_slug_warning' if show_similar_slugs_warning?(@edition) %>
      <%= render "recent_openings", edition: @edition, recent_openings: @recent_openings %>
      <div class="format-advice">
        <p><strong>Use this format for:</strong> Stand-alone government documents, issued on a specified date through GOV.UK for distribution.</p>
      </div>

      <%= edition_editing_tabs(@edition) do %>

        <%= initialise_script "GOVUK.adminEditionsForm", selector: '.js-edition-form', right_to_left_locales: Locale.right_to_left.collect(&:to_param) %>

        <%= form_for @edition, url: {action: 'update_tags'}, as: :edition, html: { class: "edition-form js-edition-form" } do |form| %>

          <%= render('locale_fields', form: form, edition: @edition) %>
          <%= edition_information(@information) if @information %>
          <%= form.errors %>

          <%= render "tag", form: form, edition: @edition %>

          <%= standard_edition_publishing_controls(form, @edition, hide_tag_button: true) %>

        <% end %>

      <% end %>
    </section>
  </div>

  <div class="col-md-4">
    <%= sidebar_tabs edition_tabs(@edition, remarks_count: @edition_remarks.length, history_count: @edition_history.total_count, editing: true) do |tabs| %>
      <%= tabs.pane class: "govspeak_help", id: "govspeak_help" do %>
        <%= render "govspeak_help", hide_inline_attachments_help: !@edition.allows_inline_attachments?,
                                    show_attachments_tab_help: true,
                                    govspeak_link_errors: force_publisher.govspeak_link_errors,
                                    links_report: @edition.links_reports.last %>

        <%= render "words_to_avoid_guidance" %>
        <h3 class="style-title">Style</h3>
        <p>For style, see the <a href="https://www.gov.uk/guidance/style-guide">style guide</a></p>
      <% end %>

      <%= tabs.pane class: "audit-trail", id: "notes" do %>
        <h1>Notes</h1>
        <p>To add a remark, save your changes.</p>
        <%= link_to "Add new remark", new_admin_edition_editorial_remark_path(@edition), class: "btn btn-default add-remark" %>
        <%= render_editorial_remarks_in_sidebar(@edition_remarks, @edition) %>
      <% end %>

      <%= tabs.pane class: "audit-trail", id: "history" do %>
        <div class="audit-trail-page">
          <h1>Activity</h1>
          <%= paginate @edition_history, theme: 'audit_trail' %>
          <ul class="list-unstyled">
            <%= render partial: "audit_trail_entry", collection: @edition_history %>
          </ul>
          <%= paginate @edition_history, theme: 'audit_trail' %>
        </div>
      <% end %>

      <% if @edition.can_be_fact_checked? %>
        <%= tabs.pane class: "fact_checking", id: "fact_checking" do %>
          <h1>Fact checking</h1>
          <%= render partial: 'fact_check_responses', locals: {edition: @edition}  %>
          <p>To send a fact check request, save your changes.</p>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
